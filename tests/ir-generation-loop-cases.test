@test("It should generate IR code on while loop statement with expression <")
@given("file")
int main() {
    int i;
    i = 0;
    while (i < 10) {
        i = i + 1;
    }
    return i * 7 + 7;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 0, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_LOAD i, t2
0005 OP_CONST 10, t3
0006 OP_JUMP_IF_GREATER_OR_EQUAL t2, t3, ".L2"
0007 OP_LOAD i, t4
0008 OP_CONST 1, t5
0009 OP_ADD t4, t5, t6
0010 OP_STORE i, t6
0011 OP_JUMP ".L1"
0012 OP_LABEL ".L2"
0013 OP_LOAD i, t7
0014 OP_CONST 7, t8
0015 OP_MUL t7, t8, t9
0016 OP_CONST 7, t10
0017 OP_ADD t9, t10, t11
0018 OP_RETURN t11
0019 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop statement with expression >")
@given("file")
int main() {
    int i;
    i = 20;
    while (i > 10) {
        i = i - 1;
    }
    return i * 7 + 7;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 20, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_LOAD i, t2
0005 OP_CONST 10, t3
0006 OP_JUMP_IF_LESS_OR_EQUAL t2, t3, ".L2"
0007 OP_LOAD i, t4
0008 OP_CONST 1, t5
0009 OP_SUB t4, t5, t6
0010 OP_STORE i, t6
0011 OP_JUMP ".L1"
0012 OP_LABEL ".L2"
0013 OP_LOAD i, t7
0014 OP_CONST 7, t8
0015 OP_MUL t7, t8, t9
0016 OP_CONST 7, t10
0017 OP_ADD t9, t10, t11
0018 OP_RETURN t11
0019 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop statement with expression ==")
@given("file")
int main() {
    int i;
    i = 0;
    while (i == 0) {
        i = i + 7;
    }
    return i;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 0, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_LOAD i, t2
0005 OP_CONST 0, t3
0006 OP_JUMP_IF_NOT_EQUAL t2, t3, ".L2"
0007 OP_LOAD i, t4
0008 OP_CONST 7, t5
0009 OP_ADD t4, t5, t6
0010 OP_STORE i, t6
0011 OP_JUMP ".L1"
0012 OP_LABEL ".L2"
0013 OP_LOAD i, t7
0014 OP_RETURN t7
0015 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop statement with expression !=")
@given("file")
int main() {
    int i;
    i = 10;
    while (i != 3) {
        i = i - 1;
    }
    return i;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 10, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_LOAD i, t2
0005 OP_CONST 3, t3
0006 OP_JUMP_IF_EQUAL t2, t3, ".L2"
0007 OP_LOAD i, t4
0008 OP_CONST 1, t5
0009 OP_SUB t4, t5, t6
0010 OP_STORE i, t6
0011 OP_JUMP ".L1"
0012 OP_LABEL ".L2"
0013 OP_LOAD i, t7
0014 OP_RETURN t7
0015 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop statement with constant false condition")
@given("file")
int main() {
    int i;
    i = 1;
    while (0) {
        i = i + 1;
    }
    return i;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 1, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_CONST 0, t2
0005 OP_JUMP_IF_FALSE t2, ".L2"
0006 OP_LOAD i, t3
0007 OP_CONST 1, t4
0008 OP_ADD t3, t4, t5
0009 OP_STORE i, t5
0010 OP_JUMP ".L1"
0011 OP_LABEL ".L2"
0012 OP_LOAD i, t6
0013 OP_RETURN t6
0014 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop statement with constant true condition")
@given("file")
int main() {
    int i;
    i = 1;
    while (1) {
        i = i + 1;
    }
    return i;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_CONST 1, t1
0002 OP_STORE i, t1
0003 OP_LABEL ".L1"
0004 OP_CONST 1, t2
0005 OP_JUMP_IF_FALSE t2, ".L2"
0006 OP_LOAD i, t3
0007 OP_CONST 1, t4
0008 OP_ADD t3, t4, t5
0009 OP_STORE i, t5
0010 OP_JUMP ".L1"
0011 OP_LABEL ".L2"
0012 OP_LOAD i, t6
0013 OP_RETURN t6
0014 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop with empty expression statement")
@given("file")
int main() {
    while (0);
    return 0;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_LABEL ".L1"
0002 OP_CONST 0, t1
0003 OP_JUMP_IF_FALSE t1, ".L2"
0004 OP_NOP
0005 OP_JUMP ".L1"
0006 OP_LABEL ".L2"
0007 OP_CONST 0, t2
0008 OP_RETURN t2
0009 OP_FUNC_END

@endtest

@test("It should generate IR code on while loop with empty compound statement")
@given("file")
int main() {
    while (0) {
    }
    return 0;
}
@whenRun("./bin/ir-generator-tester")
@expectOutput("stdout")
0000 OP_FUNC "main"
0001 OP_LABEL ".L1"
0002 OP_CONST 0, t1
0003 OP_JUMP_IF_FALSE t1, ".L2"
0004 OP_NOP
0005 OP_JUMP ".L1"
0006 OP_LABEL ".L2"
0007 OP_CONST 0, t2
0008 OP_RETURN t2
0009 OP_FUNC_END

@endtest
